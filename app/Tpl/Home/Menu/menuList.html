<include file="Public:header" />
<div class="tabs">
    <ul>
        <li class="current"><a href="javascript:void(0)" class="current">菜单列表</a></li>
    </ul>
</div>
<div class="toolbar">
    <a href="javascript:void(0)" class="btn" id="addMenu"><span>添加菜单</span></a>
    <a href="javascript:void(0)" class="btn"><span>更新菜单</span></a>
</div>
<div class="list">
    <table width="100%" border="0" cellspacing="0" cellpadding="0">
        <thead>
            <tr>
                <th width="20%">菜单名称</th>
                <th width="20%">类型</th>
                <th width="20%">菜单值</th>
                <th width="20%">排序</th>
                <th width="20%">操作</th>
            </tr>
        </thead>
        <tbody>
        <empty name="menuList">
            <tr>
                <td colspan="11" class="empty">暂无相关信息</td>
            </tr>
        <else />
            <volist name="menuList" id="vo">
                <tr>
                    <input class="tdid" type="hidden" name="id" value="{$vo.id}" />
                    <td><input class="tdname" type="text" name="name" value="{$vo.name}" /></td>
                    <td><input class="tdtype" type="radio" name="type" value="view" <eq name="vo[type]" value="view">checked="checked"</eq> >链接
                        <input class="tdtype" type="radio" name="type" value="click" <eq name="vo[type]" value="click">checked="checked"</eq> >关键字
                    </td>
                    <td><input class="tdvalue" type="text" name="value" value="{$vo.value}" /></td>
                    <td><input class="tdorder" type="number" name="sort_order" value="{$vo.sort_order}" /></td>
                    <td>
                        <a href="javascript:void(0)" class="editMenu mr10">编辑</a>
                        <a href="javascript:void(0)" onClick="del({$vo.id})" class="delete_btn">删除</a>
                    </td>
                </tr>
                <notempty name="vo[sub_button]">
                <volist name="vo[sub_button]" id="voo">
                 <tr>
                    <input class="tdid" type="hidden" name="id" value="{$voo.id}" />
                    <td>------<input class="tdname" type="text" name="name" value="{$voo.name}" /></td>
                    <td><input class="tdtype" type="radio" name="type" value="view" <eq name="voo[type]" value="view">checked="checked"</eq> >链接
                        <input class="tdtype" type="radio" name="type" value="click" <eq name="voo[type]" value="click">checked="checked"</eq> >关键字
                    </td>
                    <td><input class="tdvalue" type="text" name="value" value="{$voo.value}" /></td>
                    <td><input class="tdorder" type="number" name="sort_order" value="{$voo.sort_order}" /></td>
                    <td>
                        <a href="javascript:void(0)" class="editMenu mr10">编辑</a>
                        <a href="javascript:void(0)" onClick="del({$voo.id})" class="delete_btn">删除</a>
                    </td>
                </tr>
                </volist>
                </notempty>
            </volist>
        </empty>
        </tbody>
    </table>
</div>
<div class="toolbar">
</div>
<div id="menuForm" class="none">
    <ul>  
		<form id="myForm" method="post">
        <li>
			<div class="fid-q">上级菜单：</div>
			<select class="fid-input" name="parent_id">
				<option value="0">--</option>
				<volist name="menuList" id="vo">
				<option value="{$vo.id}">{$vo.name}</option>
				</volist>
			</select>
        </li>					
        <li> 
			<div class="fid-q">菜单名称：</div>
			<input class="fid-input" type="text" name="name"> 
        </li>
		<li>
			<div class="fid-q">类型：</div>
            <input type="radio" name="type" value="view" />链接
            <input type="radio" name="type" value="click" />关键字
		</li>
		<li>
            <div class="fid-q">菜单值：</div>
            <input class="fid-input" type="text" name="value">
        </li>
        <li>
            <div class="fid-q">排序：</div>
            <input class="fid-input" type="text" name="sort_order">
        </li>
        </form>
    </ul>
</div>
<link href="./public/css/jquery-ui.css"  rel="stylesheet" type="text/css">
<script type="text/javascript" src="./public/js/jquery-ui.js"></script>
<script>
function del(id){
	$url = '{$delMenu}';
    $.get($url, {"id":id}, function(){
            alert('删除成功');
            window.location.reload();
            });
}

$(function(){
    //添加主菜单
    $("#addMenu").click(function(){
		$("#menuForm").dialog("open");
    });

    //编辑菜单
    $(".editMenu").click(function(){
        var id=$(this).parents('tr').find('.tdid').val();
        var name=$(this).parents('tr').find('.tdname').val();
		var type=$(this).parents('tr').find(':radio').val();
        var value=$(this).parents('tr').find('.tdvalue').val();
        var sort_order=$(this).parents('tr').find('.tdorder').val();
        var data={'id':id, 'name':name, 'type':type, 'value':value, 'sort_order':sort_order};
        var url="{:U('Home/Menu/edit')}";
        $.post(url, data, function(data){
            alert('更新成功');
            });
    });

    //对话框
    $("#menuForm").dialog({
		autoOpen: false,
		height: 300,
		width: 350,
		modal: true,
		title: '添加菜单',
		buttons: {
			"确认添加": function(){
				$.post("{$addMenu}", $("#myForm").serialize(), function(data){
                    alert('添加成功');
                    window.location.reload();
				});
				$(this).dialog("close");
			},
			"取消": function(){
				$(this).dialog("close");
			}
		}
	});
});
</script>
<style>
#menuForm li{ height:26px; width:100%; float:left; padding:2px 0;}
#menuForm li .fid-q{ width:100px; float:left;}
#menuForm li .fid-input{ width:200px; height:24px; line-height:24px; border:1px solid #999;}

</style>
<include file="Public:footer"/>

